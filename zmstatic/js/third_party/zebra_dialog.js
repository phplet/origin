
(function($){$.Zebra_Dialog=function(){var defaults={animation_speed_hide:250,animation_speed_show:0,auto_close:false,buttons:true,center_buttons:false,custom_class:false,keyboard:true,max_height:0,message:"",modal:true,overlay_close:true,overlay_opacity:".9",position:"center",reposition_speed:500,show_close_button:true,source:false,title:"",type:"information",vcenter_short_message:true,width:0,onClose:null};var plugin=this,options={},timeout;plugin.settings={};if(typeof arguments[0]=="string"){options.message=arguments[0]}if(typeof arguments[0]=="object"||typeof arguments[1]=="object"){options=$.extend(options,(typeof arguments[0]=="object"?arguments[0]:arguments[1]))}plugin.init=function(){var $title;plugin.settings=$.extend({},defaults,options);plugin.isIE6=(browser.name=="explorer"&&browser.version==6)||false;if(plugin.settings.modal){plugin.overlay=jQuery("<div>",{"class":"ZebraDialogOverlay"}).css({position:(plugin.isIE6?"absolute":"fixed"),left:0,top:0,opacity:plugin.settings.overlay_opacity});if(plugin.settings.overlay_close){plugin.overlay.bind("click",function(){plugin.close()})}plugin.overlay.appendTo("body")}plugin.dialog=jQuery("<div>",{"class":"ZebraDialog"+(plugin.settings.custom_class?" "+plugin.settings.custom_class:"")}).css({position:(plugin.isIE6?"absolute":"fixed"),left:0,top:0,visibility:"hidden"});if(!plugin.settings.buttons&&plugin.settings.auto_close){plugin.dialog.attr("id","ZebraDialog_"+Math.floor(Math.random()*9999999))}var tmp=parseInt(plugin.settings.width,10);if(!isNaN(tmp)&&tmp==plugin.settings.width&&tmp.toString()==plugin.settings.width.toString()&&tmp>0){plugin.dialog.css({width:plugin.settings.width})}if(plugin.settings.title){$title=jQuery("<h3>",{"class":"ZebraDialog_Title"}).html(plugin.settings.title).appendTo(plugin.dialog)}var buttons=get_buttons();var body_container=jQuery("<div>",{"class":"ZebraDialog_BodyOuter"+(!plugin.settings.title?" ZebraDialog_NoTitle":"")+(!buttons?" ZebraDialog_NoButtons":"")}).appendTo(plugin.dialog);plugin.message=jQuery("<div>",{"class":"ZebraDialog_Body"+(get_type()!==""?" ZebraDialog_Icon ZebraDialog_"+get_type():"")});if(plugin.settings.max_height>0){plugin.message.css("max-height",plugin.settings.max_height);if(plugin.isIE6){plugin.message.attr("style","height: expression(this.scrollHeight > "+plugin.settings.max_height+' ? "'+plugin.settings.max_height+'px" : "85px")')}}if(plugin.settings.vcenter_short_message){jQuery("<div>").html(plugin.settings.message).appendTo(plugin.message)}else{plugin.message.html(plugin.settings.message)}if(plugin.settings.source&&typeof plugin.settings.source=="object"){var canvas=(plugin.settings.vcenter_short_message?$("div:first",plugin.message):plugin.message);for(var type in plugin.settings.source){switch(type){case"ajax":var ajax_options=typeof plugin.settings.source[type]=="string"?{url:plugin.settings.source[type]}:plugin.settings.source[type],preloader=jQuery("<div>").attr("class","ZebraDialog_loading").appendTo(canvas);ajax_options.success=function(result){preloader.remove();canvas.append(result);draw(false)};$.ajax(ajax_options);break;case"iframe":plugin.message.addClass("ZebraDialog_Preloader");var default_options={width:"100%",height:"100%",marginheight:"0",marginwidth:"0",frameborder:"0"},iframe_options=$.extend(default_options,typeof plugin.settings.source[type]=="string"?{src:plugin.settings.source[type]}:plugin.settings.source[type]);canvas.append(jQuery("<iframe>").attr(iframe_options).load(function(){plugin.message.removeClass("ZebraDialog_Preloader")}));break;case"inline":canvas.append(plugin.settings.source[type]);break}}}plugin.message.appendTo(body_container);if(buttons){buttons.reverse();var button_bar=jQuery("<div>",{"class":"ZebraDialog_Buttons"}).appendTo(plugin.dialog);$.each(buttons,function(index,value){var button=jQuery("<a>",{href:"javascript:void(0)","class":"ZebraDialog_Button_"+index});if($.isPlainObject(value)){button.html(value.caption)}else{button.html(value)}button.bind("click",function(){var close=true;if(undefined!==value.callback){close=value.callback(plugin.dialog)}if(close!==false){plugin.close(undefined!==value.caption?value.caption:value)}});button.appendTo(button_bar)});button_bar.wrap($("<div>").addClass("ZebraDialog_ButtonsOuter"+(plugin.settings.center_buttons?" ZebraDialog_Buttons_Centered":"")))}plugin.dialog.appendTo("body");if(plugin.settings.show_close_button){var $close=$('<a href="javascript:void(0)" class="ZebraDialog_Close">&times;</a>').bind("click",function(e){e.preventDefault();plugin.close()}).appendTo($title?$title:plugin.message);if($title){$close.css({right:parseInt($title.css("paddingRight"),10),top:(parseInt($title.css("height"),10)+parseInt($title.css("paddingTop"),10)+parseInt($title.css("paddingBottom"),10)-$close.height())/2})}}$(window).bind("resize.Zebra_Dialog",function(){clearTimeout(timeout);timeout=setTimeout(function(){draw()},100)});if(plugin.settings.keyboard){$(document).bind("keyup.Zebra_Dialog",function(e){if(e.which==27){plugin.close()}return true})}if(plugin.isIE6){$(window).bind("scroll.Zebra_Dialog",function(){emulate_fixed_position()})}if(plugin.settings.auto_close!==false){plugin.dialog.bind("click",function(){clearTimeout(plugin.timeout);plugin.close()});plugin.timeout=setTimeout(plugin.close,plugin.settings.auto_close)}draw(false);return plugin};plugin.close=function(caption){$(document).unbind(".Zebra_Dialog");$(window).unbind(".Zebra_Dialog");if(plugin.overlay){plugin.overlay.animate({opacity:0},plugin.settings.animation_speed_hide,function(){plugin.overlay.remove()})}plugin.dialog.animate({top:0,opacity:0},plugin.settings.animation_speed_hide,function(){plugin.dialog.remove();if(plugin.settings.onClose&&typeof plugin.settings.onClose=="function"){plugin.settings.onClose(undefined!==caption?caption:"")}})};var draw=function(){var viewport_width=$(window).width(),viewport_height=$(window).height(),dialog_width=plugin.dialog.width(),dialog_height=plugin.dialog.height(),values={left:0,top:0,right:viewport_width-dialog_width,bottom:viewport_height-dialog_height,center:(viewport_width-dialog_width)/2,middle:(viewport_height-dialog_height)/2};plugin.dialog_left=undefined;plugin.dialog_top=undefined;if($.isArray(plugin.settings.position)&&plugin.settings.position.length==2&&typeof plugin.settings.position[0]=="string"&&plugin.settings.position[0].match(/^(left|right|center)[\s0-9\+\-]*$/)&&typeof plugin.settings.position[1]=="string"&&plugin.settings.position[1].match(/^(top|bottom|middle)[\s0-9\+\-]*$/)){plugin.settings.position[0]=plugin.settings.position[0].toLowerCase();plugin.settings.position[1]=plugin.settings.position[1].toLowerCase();$.each(values,function(index,value){for(var i=0;i<2;i++){var tmp=plugin.settings.position[i].replace(index,value);if(tmp!=plugin.settings.position[i]){if(i===0){plugin.dialog_left=eval(tmp)}else{plugin.dialog_top=eval(tmp)}}}})}if(undefined===plugin.dialog_left||undefined===plugin.dialog_top){plugin.dialog_left=values.center;plugin.dialog_top=values.middle}if(plugin.settings.vcenter_short_message){var message=plugin.message.find("div:first"),message_height=message.height(),container_height=plugin.message.height();if(message_height<container_height){message.css({"padding-top":(container_height-message_height)/2})}}if((typeof arguments[0]=="boolean"&&arguments[0]===false)||plugin.settings.reposition_speed===0){plugin.dialog.css({left:plugin.dialog_left,top:plugin.dialog_top,visibility:"visible",opacity:0}).animate({opacity:1},plugin.settings.animation_speed_show)}else{plugin.dialog.stop(true);plugin.dialog.css("visibility","visible").animate({left:plugin.dialog_left,top:plugin.dialog_top},plugin.settings.reposition_speed)}plugin.dialog.find("a[class^=ZebraDialog_Button]:first").focus();if(plugin.isIE6){setTimeout(emulate_fixed_position,500)}};var emulate_fixed_position=function(){var scroll_top=$(window).scrollTop(),scroll_left=$(window).scrollLeft();if(plugin.settings.modal){plugin.overlay.css({top:scroll_top,left:scroll_left})}plugin.dialog.css({left:plugin.dialog_left+scroll_left,top:plugin.dialog_top+scroll_top})};var get_buttons=function(){if(plugin.settings.buttons!==true&&!$.isArray(plugin.settings.buttons)){return false}if(plugin.settings.buttons===true){switch(plugin.settings.type){case"question":plugin.settings.buttons=["Yes","No"];break;default:plugin.settings.buttons=["Ok"]}}return plugin.settings.buttons};var get_type=function(){switch(plugin.settings.type){case"confirmation":case"error":case"information":case"question":case"warning":return plugin.settings.type.charAt(0).toUpperCase()+plugin.settings.type.slice(1).toLowerCase();default:return false}};var browser={init:function(){this.name=this.searchString(this.dataBrowser)||"";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||""},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;var dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!=-1){return data[i].identity}}else{if(dataProp){return data[i].identity}}}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1){return}return parseFloat(dataString.substring(index+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"MSIE",identity:"explorer",versionSearch:"MSIE"}]};browser.init();return plugin.init()}})(jQuery);

